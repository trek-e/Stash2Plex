---
phase: between-phases (debug session completed)
task: N/A
total_tasks: N/A
status: between_milestones
last_updated: 2026-02-28T16:15:36.236Z
---

<current_state>
v1.5.18 just released — fixed PlexNotFound retry storm in batch path.
Previous pause (commit 7698c46) indicated "ready for Phase 25 Match Endpoint".
No active phase in progress. Provider HTTP skeleton (Phase 24) is done.
</current_state>

<completed_work>

## Recent Hotfixes (this session)

- v1.5.18: Fixed PlexNotFound retry storm in batch process_queue() loop
  - Batch loop missing _is_ready_for_retry() guard that worker loop already had
  - SQLiteAckQueue returns re-enqueued jobs immediately (next_retry_at is opaque payload)
  - Same scene retried 3-5x in 2 seconds instead of respecting 30s backoff
  - Three changes: import nack_job, backoff guard, mark scene as processed on re-enqueue
  - 142 tests passing, tagged, released

## Prior Hotfixes

- v1.5.17: PlexNotFound no longer trips circuit breaker in batch path
- v1.5.7-v1.5.10: Various queue dedup, Job None, false outage, index.yml fixes
- v1.5.0-v1.5.5: All outage resilience features + comprehensive audit fixes
</completed_work>

<remaining_work>

- Phase 25: Match Endpoint (next planned phase — not started)
- User should verify v1.5.18 in production: trigger sync for un-scanned scenes, confirm single PlexNotFound per scene per batch run
- Low-priority items from prior sessions still open (see .planning/debug/resolved/)
</remaining_work>

<decisions_made>

- v1.5.18 fix mirrors existing _is_ready_for_retry() pattern from _worker_loop (processor.py lines 403-411)
- Also added scene_id to processed_scenes on PlexNotFound re-enqueue to prevent same-batch re-pull
- Sibling bug to v1.5.17: both stem from batch loop being a simplified copy missing worker guards
</decisions_made>

<blockers>
None
</blockers>

<context>
The batch process_queue() in Stash2Plex.py was a simplified copy of the background
worker loop but never received the same safety guards. v1.5.17 fixed the circuit breaker
side, v1.5.18 fixes the retry-backoff side. Root issue: SQLiteAckQueue treats payloads
as opaque blobs — metadata like next_retry_at must be checked application-side.

Next milestone work: Phase 25 Match Endpoint (provider HTTP skeleton phase 24 is done).
</context>

<next_action>
Start with: /gsd:progress to check project state, then /gsd:plan-phase for Phase 25 Match Endpoint.
Optionally verify v1.5.18 fix in production first.
</next_action>
