# Requirements Archive: v1.5 Outage Resilience

**Archived:** 2026-02-24
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: PlexSync v1.5 Outage Resilience

**Defined:** 2026-02-15
**Core Value:** Reliable sync — when metadata changes in Stash, it eventually reaches Plex — even if Plex was temporarily unavailable

## v1.5 Requirements

Requirements for outage resilience milestone. Each maps to roadmap phases.

### Recovery

- [x] **RECV-01**: Plugin automatically drains pending queue jobs when Plex recovers from outage without user interaction
- [x] **RECV-02**: Active health check probes Plex during circuit OPEN state to detect recovery
- [x] **RECV-03**: Plugin logs recovery notification when circuit transitions from OPEN back to CLOSED
- [x] **RECV-04**: Queue draining after recovery uses graduated rate limiting to avoid overwhelming Plex

### Health Monitoring

- [x] **HLTH-01**: Plex health check using lightweight endpoint validates server connectivity
- [x] **HLTH-02**: Passive health checks (job success/failure) combined with active probes for hybrid monitoring
- [x] **HLTH-03**: Health check interval uses exponential backoff during extended outages (5s → 60s cap)

### State Persistence

- [x] **STAT-01**: Circuit breaker state persists to JSON file and survives plugin restarts
- [x] **STAT-02**: Recovery scheduler tracks check timing via persisted state file

### Outage Visibility

- [x] **VISB-01**: Queue status UI shows circuit breaker state and recovery timing
- [x] **VISB-02**: All circuit breaker state transitions logged with descriptive messages
- [x] **VISB-03**: Outage history tracks start/end times, duration, and jobs affected (last 30 outages)
- [x] **VISB-04**: Outage summary report available as Stash UI task

### DLQ Management

- [x] **DLQM-01**: "Recover Outage Jobs" task re-queues DLQ entries with transient errors from outage windows
- [x] **DLQM-02**: DLQ recovery supports per-error-type filtering (PlexServerDown, Timeout, etc.)

## Future Requirements

### Advanced Recovery

- **RECV-05**: Outage-triggered reconciliation detects metadata gaps from hook events missed during extended outages
- **RECV-06**: Configurable recovery strategies per error type (aggressive/conservative)

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Real-time push notifications | Stash plugins not daemons; external monitoring tools (Uptime Kuma) solve this |
| Automatic full reconciliation on recovery | Too expensive for large libraries (10K+ items); user-triggered with scope filter safer |
| Multi-tiered circuit breakers | Over-engineering; PlexServerDown already gets special handling (999 retries) |
| External health check endpoint | Plugin can't serve HTTP; Plex has native health endpoints |
| Automatic failover to backup server | Complex; manual failover via config change is safer |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| RECV-01 | Phase 19 | Complete |
| RECV-02 | Phase 19 | Complete |
| RECV-03 | Phase 19 | Complete |
| RECV-04 | Phase 20 | Complete |
| HLTH-01 | Phase 18 | Complete |
| HLTH-02 | Phase 18 | Complete |
| HLTH-03 | Phase 18 | Complete |
| STAT-01 | Phase 17 | Complete |
| STAT-02 | Phase 19 | Complete |
| VISB-01 | Phase 21 | Complete |
| VISB-02 | Phase 17 | Complete |
| VISB-03 | Phase 21 | Complete |
| VISB-04 | Phase 21 | Complete |
| DLQM-01 | Phase 22 | Complete |
| DLQM-02 | Phase 22 | Complete |

**Coverage:**
- v1.5 requirements: 15 total
- Mapped to phases: 15 (100%)
- Unmapped: 0 ✓

**Phase Distribution:**
- Phase 17 (Circuit Breaker Persistence): 2 requirements
- Phase 18 (Health Check Infrastructure): 3 requirements
- Phase 19 (Recovery Detection & Automation): 4 requirements
- Phase 20 (Graduated Recovery & Rate Limiting): 1 requirement
- Phase 21 (Outage Visibility & History): 3 requirements
- Phase 22 (DLQ Recovery for Outage Jobs): 2 requirements

---
*Requirements defined: 2026-02-15*
*Last updated: 2026-02-15 after Phase 22 execution — all 15 requirements complete*
