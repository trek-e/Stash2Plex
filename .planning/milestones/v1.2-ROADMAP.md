# Milestone v1.2: Queue UI Improvements

**Status:** SHIPPED 2026-02-04
**Phases:** 11-13
**Total Plans:** 3

## Overview

Focus: User-facing queue management improvements. Allow users to manage stuck/dead queues directly from Stash UI and handle timeout issues for large backlogs.

## Phases

### Phase 11: Queue Management UI ✓

**Goal:** Add queue management tasks to Stash plugin menu for viewing status and clearing stuck/dead items

**Depends on:** Phase 10
**Plans:** 1 plan

Plans:
- [x] 11-01-PLAN.md — Add queue management tasks (status, clear queue, clear/purge DLQ)

**Deliverables:**
- `handle_queue_status()` — View pending/DLQ counts and error summary
- `handle_clear_queue()` — Delete all pending queue items
- `handle_clear_dlq()` — Clear all dead letter queue entries
- `handle_purge_dlq()` — Remove DLQ entries older than 7 days
- 4 new tasks in Stash2Plex.yml

---

### Phase 12: Process Queue Button ✓

**Goal:** Add process queue button to handle stalled queues due to time limits

**Depends on:** Phase 11
**Plans:** 1 plan

Plans:
- [x] 12-01-PLAN.md — Add foreground queue processor with progress reporting

**Deliverables:**
- `handle_process_queue()` — Foreground processing with while-true loop until empty
- Progress reporting every 5 items or 10 seconds
- Circuit breaker integration
- DLQ handling for permanent failures
- 1 new task in Stash2Plex.yml

---

### Phase 13: Dynamic Queue Timeout ✓

**Goal:** Make queue processing timeout dynamic based on item count and average processing time

**Depends on:** Phase 12
**Plans:** 1 plan

Plans:
- [x] 13-01-PLAN.md — Dynamic timeout calculation using measured processing times

**Deliverables:**
- `SyncStats.get_estimated_timeout()` — Calculate timeout from measured avg processing time
- Cold start handling with 2.0s default per item
- Small sample blending (1-4 jobs gradually trust measured data)
- Timeout clamped to [30s, 600s] range
- Improved timeout message with Process Queue guidance

---

## Phase Dependencies

```
Phase 11 (Queue UI)
    |
Phase 12 (Process Queue)
    |
Phase 13 (Dynamic Timeout)
```

## Stats

| Metric | Count |
|--------|-------|
| Phases | 3 |
| Plans | 3 |
| Commits | 15 |
| Lines added | ~370 |

## Requirements Satisfied

All 16 requirements from v1.2 REQUIREMENTS.md:
- QUEUE-01 through QUEUE-05 (Queue Management)
- PROC-01 through PROC-06 (Queue Processing)
- TIME-01 through TIME-05 (Dynamic Timeout, TIME-03 N/A due to Stash limitation)

## Key Files Changed

- `worker/stats.py` — Added get_estimated_timeout() method
- `sync_queue/operations.py` — Added clear_pending_items() function
- `Stash2Plex.py` — Added 5 handler functions, dynamic timeout logic
- `Stash2Plex.yml` — Added 5 new task definitions (7 total tasks)

---
*Shipped: 2026-02-04*
