---
phase: 06-api-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - requirements-dev.txt
  - mkdocs.yml
  - docs/api/index.md
  - docs/api/sync_queue.md
  - docs/api/validation.md
  - docs/api/plex.md
  - docs/api/worker.md
autonomous: true

must_haves:
  truths:
    - "Running mkdocs serve shows documentation site with API reference"
    - "Each public module has generated documentation from docstrings"
    - "API pages link to architecture documentation"
    - "Key functions have Examples sections in docstrings"
  artifacts:
    - path: "mkdocs.yml"
      provides: "MkDocs configuration with mkdocstrings"
      contains: "mkdocstrings"
    - path: "docs/api/index.md"
      provides: "API reference overview page"
      min_lines: 20
    - path: "docs/api/sync_queue.md"
      provides: "sync_queue module documentation"
      contains: "::: sync_queue"
    - path: "docs/api/validation.md"
      provides: "validation module documentation"
      contains: "::: validation"
    - path: "docs/api/plex.md"
      provides: "plex module documentation"
      contains: "::: plex"
    - path: "docs/api/worker.md"
      provides: "worker module documentation"
      contains: "::: worker"
  key_links:
    - from: "mkdocs.yml"
      to: "docs/api/*.md"
      via: "nav configuration"
      pattern: "api/sync_queue"
    - from: "docs/api/*.md"
      to: "docs/ARCHITECTURE.md"
      via: "cross-reference links"
      pattern: "ARCHITECTURE.md"
---

<objective>
Set up MkDocs with mkdocstrings for auto-generated API documentation

Purpose: Enable developers to browse generated API reference from Python docstrings, integrated with existing user and architecture documentation
Output: Complete MkDocs site with API reference pages for all 4 core modules (sync_queue, validation, plex, worker)
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-api-documentation/06-RESEARCH.md

# Architecture docs for cross-reference
@docs/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure MkDocs with mkdocstrings</name>
  <files>
    requirements-dev.txt
    mkdocs.yml
  </files>
  <action>
Add documentation dependencies to requirements-dev.txt:
```
mkdocs-material>=9.7.0
mkdocstrings[python]>=1.0.0
```

Create mkdocs.yml at project root with this configuration:
- site_name: PlexSync
- site_description: Stash to Plex metadata sync plugin
- theme: material with navigation.sections, navigation.expand, search.suggest, content.code.copy features
- plugins: search, mkdocstrings with python handler
- mkdocstrings config:
  - paths: [.] (project root for module finding)
  - docstring_style: google
  - show_source: true
  - show_root_heading: true
  - show_root_full_path: false
  - members_order: source
  - filters: ["!^_"] (hide private members)
- nav structure:
  - Home: index.md (create minimal if doesn't exist)
  - User Guide: install.md, config.md, troubleshoot.md
  - Architecture: ARCHITECTURE.md
  - API Reference: api/index.md, api/sync_queue.md, api/validation.md, api/plex.md, api/worker.md
- markdown_extensions: admonition, pymdownx.details, pymdownx.superfences, pymdownx.highlight with anchor_linenums, toc with permalink

Create docs/index.md as simple redirect/overview page pointing to install.md for getting started.

Reference 06-RESEARCH.md for exact configuration syntax.
  </action>
  <verify>
Run: `pip install -r requirements-dev.txt` then `mkdocs build --strict`
Both commands must complete without errors.
  </verify>
  <done>
mkdocs.yml exists with mkdocstrings configured, requirements-dev.txt has documentation deps, `mkdocs build --strict` succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create API reference pages</name>
  <files>
    docs/api/index.md
    docs/api/sync_queue.md
    docs/api/validation.md
    docs/api/plex.md
    docs/api/worker.md
  </files>
  <action>
Create docs/api/ directory and the following pages:

**docs/api/index.md** - API Reference overview:
- Brief intro: "Auto-generated reference for PlexSync Python modules"
- Link to ARCHITECTURE.md for design context
- List the 4 modules with one-line descriptions:
  - sync_queue: Persistent job queue with crash recovery
  - validation: Metadata validation and sanitization
  - plex: Plex server client and file path matching
  - worker: Job processing with retry, circuit breaker, backoff

**docs/api/sync_queue.md** - sync_queue module:
- Title: sync_queue Module
- Cross-ref: "See [Persistence Layer](../ARCHITECTURE.md#sync_queue---persistence-layer) for design rationale."
- Sections with mkdocstrings autodoc:
  - QueueManager: `::: sync_queue.manager.QueueManager`
  - Operations: `::: sync_queue.operations`
  - Models: `::: sync_queue.models`
  - Dead Letter Queue: `::: sync_queue.dlq`

**docs/api/validation.md** - validation module:
- Title: validation Module
- Cross-ref: "See [Validation Layer](../ARCHITECTURE.md#validation---data-integrity) for design rationale."
- Sections:
  - SyncMetadata: `::: validation.metadata`
  - PlexSyncConfig: `::: validation.config`
  - Sanitizers: `::: validation.sanitizers`
  - Errors: `::: validation.errors`

**docs/api/plex.md** - plex module:
- Title: plex Module
- Cross-ref: "See [Plex Integration](../ARCHITECTURE.md#plex---server-integration) for design rationale."
- Sections:
  - PlexClient: `::: plex.client`
  - PlexMatcher: `::: plex.matcher`
  - Device Identity: `::: plex.device_identity`
  - Exceptions: `::: plex.exceptions`

**docs/api/worker.md** - worker module:
- Title: worker Module
- Cross-ref: "See [Worker](../ARCHITECTURE.md#worker---job-processing) for design rationale."
- Sections:
  - QueueProcessor: `::: worker.processor`
  - Circuit Breaker: `::: worker.circuit_breaker`
  - Backoff Calculator: `::: worker.backoff`

Use mkdocstrings options on each directive:
```markdown
::: module.submodule
    options:
      members_order: source
      show_source: true
```
  </action>
  <verify>
Run: `mkdocs build --strict`
Must complete without "Could not find module" errors. Check site/ folder contains api/*.html files.
  </verify>
  <done>
5 API reference pages exist in docs/api/. Each page has mkdocstrings autodoc directives. `mkdocs build --strict` generates HTML without module-not-found errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Examples to key docstrings and verify site</name>
  <files>
    sync_queue/operations.py
    validation/metadata.py
    plex/client.py
    worker/backoff.py
  </files>
  <action>
Per 06-RESEARCH.md docstring audit, add Example sections to key functions that lack them.

**sync_queue/operations.py** - enqueue() function:
Add Example section showing basic usage:
```python
Example:
    >>> from sync_queue.operations import enqueue
    >>> job = enqueue(queue, metadata, config)
    >>> print(job.job_id)
    'abc123...'
```

**validation/metadata.py** - SyncMetadata class:
Add Example section in class docstring showing construction:
```python
Example:
    >>> from validation.metadata import SyncMetadata
    >>> meta = SyncMetadata(
    ...     stash_id="123",
    ...     title="Example Scene",
    ...     file_path="/media/example.mp4"
    ... )
```

**plex/client.py** - PlexClient class:
Add Example section showing initialization:
```python
Example:
    >>> from plex.client import PlexClient
    >>> client = PlexClient(
    ...     server_url="http://plex:32400",
    ...     token="your-token",
    ...     timeout=10
    ... )
```

**worker/backoff.py** - calculate_backoff() function:
Add Example section per research:
```python
Example:
    >>> from worker.backoff import calculate_backoff
    >>> delay = calculate_backoff(attempt=3, base=1.0, max_delay=60.0)
    >>> 1.0 <= delay <= 8.0  # 2^3 = 8, with jitter
    True
```

After adding examples, run `mkdocs serve` and verify:
1. Site loads at http://127.0.0.1:8000
2. Navigate to API Reference section
3. Each module page renders docstrings
4. Examples appear in rendered output
5. Cross-references to ARCHITECTURE.md work

Stop mkdocs serve after verification.
  </action>
  <verify>
Run: `mkdocs build --strict` - must complete without errors.
Run: `grep -l "Example:" sync_queue/operations.py validation/metadata.py plex/client.py worker/backoff.py` - all 4 files must match.
  </verify>
  <done>
4 key files have Example sections added. `mkdocs build --strict` succeeds. Site renders with API documentation showing docstring content including examples.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `pip install -r requirements-dev.txt` - installs mkdocs-material, mkdocstrings
2. `mkdocs build --strict` - builds site without warnings
3. `ls site/api/` - contains index.html, sync_queue.html, validation.html, plex.html, worker.html
4. `mkdocs serve` - serves documentation at localhost:8000
5. Manual check: API pages show auto-generated content from docstrings
</verification>

<success_criteria>
- mkdocs.yml configured with mkdocstrings-python handler
- 5 API reference pages created (index + 4 modules)
- Each module page uses ::: autodoc syntax
- Key functions have Example sections in docstrings
- `mkdocs build --strict` completes without errors
- Generated site includes API reference with rendered docstrings
</success_criteria>

<output>
After completion, create `.planning/phases/06-api-documentation/06-01-SUMMARY.md`
</output>
