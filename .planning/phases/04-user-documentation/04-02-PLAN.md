---
phase: 04-user-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/install.md
autonomous: true

must_haves:
  truths:
    - "User can install PlexSync from scratch following only this guide"
    - "User understands PythonDepManager requirement and why"
    - "Both Docker and bare metal deployments covered"
    - "User knows where data files are stored"
  artifacts:
    - path: "docs/install.md"
      provides: "Complete installation instructions"
      min_lines: 100
      contains: "PythonDepManager"
  key_links:
    - from: "docs/install.md"
      to: "docs/config.md"
      via: "markdown link"
      pattern: "\\[.*\\]\\(config\\.md\\)"
---

<objective>
Create comprehensive installation guide covering Stash plugin setup, dependencies, and both Docker and bare metal deployments.

Purpose: Enable new users to install PlexSync without external help
Output: docs/install.md
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-user-documentation/04-CONTEXT.md
@.planning/phases/04-user-documentation/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/install.md</name>
  <files>docs/install.md</files>
  <action>
Create docs/install.md with the following structure:

1. **Title**
   - "# Installation Guide"

2. **Prerequisites**
   - Stash installed and running (link to Stash docs)
   - Plex Media Server installed and running
   - Access to Stash plugins folder
   - A Plex authentication token (explain how to get it - see below)

3. **Step 1: Install PythonDepManager**
   - Explain: PlexSync requires Python dependencies that are auto-installed via PythonDepManager
   - Link to PythonDepManager in Stash plugin repo or explain installation
   - Note: This is a one-time setup

4. **Step 2: Install PlexSync**
   Two methods:

   **Method A: From Stash Plugin Repo** (if available)
   - Settings > Plugins > Available Plugins > Search "PlexSync"
   - Click Install

   **Method B: Manual Installation**
   - Clone or download PlexSync repository
   - Copy to Stash plugins folder:
     - Bare metal: `~/.stash/plugins/PlexSync/`
     - Docker: `/root/.stash/plugins/PlexSync/` or `/config/plugins/PlexSync/`
   - Ensure structure matches:
     ```
     PlexSync/
       PlexSync.py
       PlexSync.yml
       requirements.txt
       hooks/
       plex/
       sync_queue/
       validation/
       worker/
     ```

5. **Step 3: Reload Plugins**
   - Go to Settings > Plugins
   - Click "Reload Plugins" button
   - PlexSync should appear in the list
   - Check for any errors in Stash logs

6. **Step 4: Configure PlexSync**
   - Go to Settings > Plugins > PlexSync
   - Set required fields:
     - `plex_url`: Your Plex server URL (e.g., `http://192.168.1.100:32400`)
     - `plex_token`: Your Plex authentication token
     - `plex_library`: Name of your library (e.g., "Adult")
   - Link to [Configuration Reference](config.md) for all settings

7. **Getting Your Plex Token**
   Dedicated section with clear instructions:
   - Option 1: From Plex Web
     - Log into Plex web app
     - Play any media
     - Open browser developer tools (F12)
     - Go to Network tab
     - Look for requests to your Plex server
     - Find `X-Plex-Token` in request headers
   - Option 2: From Plex desktop app
     - Open Plex Media Server settings
     - Look for XML file or use third-party token extractors
   - Link to official Plex documentation if available

8. **Docker Considerations**
   - Path mapping: Stash and Plex must see the same file paths
   - Example docker-compose snippet showing volume mounts
   - Network: Use container names or `host.docker.internal` for plex_url
   - Note: If paths differ, matching will fail

9. **Verifying Installation**
   - Update a scene in Stash
   - Check Stash logs for `[PlexSync]` messages
   - Success message: `Enqueued sync job for scene X`
   - Check Plex for updated metadata (may take a few seconds)

10. **Data Directory**
    - PlexSync stores runtime data in `data/` subdirectory:
      - `queue/` - Persistent queue database
      - `dlq.db` - Dead letter queue
      - `sync_timestamps.json` - Last sync times
      - `device_id.json` - Plex device identity
    - Location varies by deployment (list paths from RESEARCH.md)

11. **Troubleshooting Installation**
    - Common issue: PythonDepManager not installed -> error about missing modules
    - Common issue: Wrong plugins folder -> plugin not appearing
    - Common issue: Permission errors -> check folder permissions
    - Link to [Troubleshooting Guide](troubleshoot.md) for more

12. **Next Steps**
    - Link to [Configuration Reference](config.md) to tune settings
    - Link to [Troubleshooting](troubleshoot.md) if issues arise
  </action>
  <verify>
    - File exists: `test -f docs/install.md && echo "EXISTS"`
    - Has prerequisites: `grep -q "Prerequisites" docs/install.md && echo "HAS_PREREQS"`
    - Has PythonDepManager: `grep -q "PythonDepManager" docs/install.md && echo "HAS_PDM"`
    - Has Docker section: `grep -q "Docker" docs/install.md && echo "HAS_DOCKER"`
    - Has token instructions: `grep -q "Plex Token" docs/install.md && echo "HAS_TOKEN"`
    - Links to config: `grep -q "config.md" docs/install.md && echo "HAS_CONFIG_LINK"`
    - Line count: `wc -l docs/install.md` (should be 100-200 lines)
  </verify>
  <done>
docs/install.md exists with:
- Clear prerequisites section
- PythonDepManager installation explained
- Both manual and plugin-repo installation methods
- Docker and bare metal paths covered
- Plex token retrieval instructions
- Data directory locations documented
- Links to config.md and troubleshoot.md
  </done>
</task>

</tasks>

<verification>
All checks pass:
- `test -f docs/install.md` returns success
- `grep -q "PythonDepManager" docs/install.md` returns success
- `grep -q "Docker" docs/install.md` returns success
- `grep -q "config.md" docs/install.md` returns success
</verification>

<success_criteria>
- New user can follow guide from zero to working PlexSync
- PythonDepManager dependency clearly explained
- Both Docker and bare metal users have clear instructions
- Plex token retrieval has step-by-step instructions
- Links to other docs for further reading
</success_criteria>

<output>
After completion, create `.planning/phases/04-user-documentation/04-02-SUMMARY.md`
</output>
