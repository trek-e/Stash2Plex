---
phase: 01-testing-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pytest.ini
  - requirements-dev.txt
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "pytest runs and discovers tests in tests/ directory"
    - "Coverage reporting is enabled with 80% threshold"
    - "Test dependencies are separate from runtime dependencies"
  artifacts:
    - path: "pytest.ini"
      provides: "pytest configuration"
      contains: "testpaths = tests"
    - path: "requirements-dev.txt"
      provides: "test dependencies"
      contains: "pytest"
  key_links:
    - from: "pytest.ini"
      to: "tests/"
      via: "testpaths configuration"
      pattern: "testpaths.*=.*tests"
---

<objective>
Configure pytest with coverage reporting for PlexSync test infrastructure.

Purpose: Establish the foundational pytest configuration that all future tests will use. This includes test discovery paths, coverage thresholds, and development dependencies.

Output: pytest.ini with coverage options, requirements-dev.txt with test dependencies
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-testing-infrastructure/01-RESEARCH.md

# Existing test structure to preserve
@tests/__init__.py
@tests/test_backoff.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pytest.ini configuration</name>
  <files>pytest.ini</files>
  <action>
Create pytest.ini in project root with:
- testpaths = tests
- python_files = test_*.py
- python_classes = Test*
- python_functions = test_*
- addopts with:
  - -v (verbose)
  - --tb=short (concise tracebacks)
  - --strict-markers (fail on unknown markers)
  - --cov=plex --cov=sync_queue --cov=worker --cov=validation --cov=hooks (coverage for all modules)
  - --cov-report=term-missing (show missing lines)
  - --cov-report=html:coverage_html (HTML report)
  - --cov-fail-under=80 (80% minimum threshold)
- markers section with:
  - slow: marks tests as slow (deselect with '-m "not slow"')
  - integration: marks tests as integration tests

Do NOT use pytest-bdd, pytest-asyncio, or other plugins not in research.
  </action>
  <verify>cat pytest.ini shows all specified configuration</verify>
  <done>pytest.ini exists with testpaths, addopts with coverage, and markers</done>
</task>

<task type="auto">
  <name>Task 2: Create requirements-dev.txt with test dependencies</name>
  <files>requirements-dev.txt</files>
  <action>
Create requirements-dev.txt with test dependencies:
- pytest>=9.0.0
- pytest-mock>=3.14.0
- pytest-cov>=6.0.0

Include comment at top explaining this is for development/testing only.
Keep separate from requirements.txt (runtime dependencies).
  </action>
  <verify>cat requirements-dev.txt shows pytest, pytest-mock, pytest-cov with version constraints</verify>
  <done>requirements-dev.txt exists with correct test dependencies</done>
</task>

<task type="auto">
  <name>Task 3: Update .gitignore for coverage artifacts</name>
  <files>.gitignore</files>
  <action>
Add to existing .gitignore:
- coverage_html/ (HTML coverage reports)
- .coverage (coverage data file)
- htmlcov/ (alternate coverage directory)

Preserve all existing .gitignore entries. Add new entries at end with comment "# Testing/coverage".
  </action>
  <verify>grep "coverage_html" .gitignore returns the new entry</verify>
  <done>.gitignore includes coverage artifact patterns</done>
</task>

</tasks>

<verification>
Run these commands to verify plan completion:
1. `cat pytest.ini` - verify configuration exists
2. `cat requirements-dev.txt` - verify test dependencies
3. `grep coverage .gitignore` - verify gitignore updates
4. `pip install -r requirements-dev.txt && python -m pytest --collect-only` - verify pytest discovers existing tests
</verification>

<success_criteria>
- pytest.ini exists with coverage configuration targeting 80%
- requirements-dev.txt exists with pytest>=9.0.0, pytest-mock>=3.14.0, pytest-cov>=6.0.0
- .gitignore excludes coverage artifacts
- `pytest --collect-only` discovers existing tests in tests/
</success_criteria>

<output>
After completion, create `.planning/phases/01-testing-infrastructure/01-01-SUMMARY.md`
</output>
